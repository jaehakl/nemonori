import{j as e,r as u}from"./index-Dwc8S6Nr.js";import{c as v}from"./index-oiFZrnAu.js";function m(s={}){const c=s.nodes||{},n=s.start||Object.keys(c)[0];let r={nodeId:n};return{id:"narrative",init(a){a.state.narrative||(a.state.narrative={}),Object.assign(a.state.narrative,r)},actions:{start(a,i){return r.nodeId=n,i.state.narrative.nodeId=n,[{type:"log",msg:"ëª¨í—˜ì„ ì‹œì‘í•œë‹¤."}]},choose({index:a},i){var g;const f=c[r.nodeId],t=(g=f==null?void 0:f.choices)==null?void 0:g[a];if(!t)return[];if(t.req){const o=t.req.v!==void 0?t.req.v:!0;if((i.state.flags[t.req.key]||!1)!==o)return[{type:"log",msg:"ê·¸ ì„ íƒì€ ì§€ê¸ˆì€ í•  ìˆ˜ ì—†ë‹¤."}]}const d=[];if(Array.isArray(t.effects)&&d.push(...t.effects),t.set)for(const[o,l]of Object.entries(t.set))d.push({type:"flag.set",key:o,v:l});return t.goto&&(r.nodeId=t.goto,i.state.narrative.nodeId=t.goto),t.text&&d.push({type:"log",msg:`â–¶ ${t.text}`}),d}}}}const p="intro",y={intro:{text:"í•´ê°€ ì €ë¬´ëŠ” ìˆ² ì…êµ¬. ë„ˆëŠ” ì£¼ë¨¸ë‹ˆì— ë™ì „ ëª‡ ë‹¢ê³¼ ë…¹ìŠ¨ ë‹¨ê²€ í•˜ë‚˜ë¥¼ ì¥ê³  ìˆë‹¤.",choices:[{text:"ì£¼ì ìœ¼ë¡œ ê°„ë‹¤",goto:"tavern",effects:[{type:"resource.add",k:"gold",v:5},{type:"log",msg:"ì£¼ì¸ì€ ì²« ì”ì„ ê³µì§œë¡œ ë‚´ì–´ì¤€ë‹¤."}]},{text:"ìˆ²ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤",goto:"forest",effects:[{type:"log",msg:"ë°”ëŒì´ ìì‚¬ê·€ë¥¼ ìŠ¤ì¹œë‹¤."}]}]},tavern:{text:"ì‹œëŒë²…ì í•œ ì£¼ì . ìˆ˜ìƒí•œ ê³„ì•½ì„œë¥¼ í”ë“œëŠ” ìƒì¸ì´ ë³´ì¸ë‹¤.",choices:[{text:"ê³„ì•½ì„œë¥¼ ì½ëŠ”ë‹¤ (ìš©ë³‘ ëª¨ì§‘)",effects:[{type:"flag.set",key:"has_contract",v:!0}],goto:"tavern"},{text:"ìƒì¸ì—ê²Œì„œ ì •ë³´ë¥¼ ì‚°ë‹¤ (-3 gold)",effects:[{type:"resource.add",k:"gold",v:-3},{type:"flag.set",key:"forest_hint",v:!0}],goto:"tavern"},{text:"ìˆ²ìœ¼ë¡œ ê°„ë‹¤",goto:"forest"},{text:"ë§ˆì„ ë°–ìœ¼ë¡œ ë– ë‚œë‹¤",goto:"road"}]},forest:{text:"ìˆ²ì† ê³µí„°. ë°œìêµ­ì´ ê²¹ê²¹ì´ ì°í˜€ ìˆë‹¤.",choices:[{text:"í”ì ì„ ë”°ë¼ê°„ë‹¤ (íŒíŠ¸ í•„ìš”)",req:{key:"forest_hint",v:!0},effects:[{type:"log",msg:"ìˆ¨ê²¨ì§„ ì˜¤ë‘ë§‰ì„ ì°¾ì•˜ë‹¤."}],goto:"hut"},{text:"ë‚˜ë¬´ì—´ë§¤ë¥¼ ëª¨ì€ë‹¤ (+2 gold)",effects:[{type:"resource.add",k:"gold",v:2}],goto:"forest"},{text:"ë§ˆì„ë¡œ ëŒì•„ê°„ë‹¤",goto:"tavern"}]},hut:{text:"ì˜¤ë‘ë§‰ ì•ˆì—ëŠ” ë‚¡ì€ ìƒì í•˜ë‚˜ì™€ ë´‰ì¸ëœ í¸ì§€ê°€ ìˆë‹¤.",choices:[{text:"ìƒìë¥¼ ì—°ë‹¤ (+10 gold)",effects:[{type:"resource.add",k:"gold",v:10}],goto:"hut"},{text:"í¸ì§€ë¥¼ ì—°ë‹¤ (ê³„ì•½ì´ í™œì„±í™”ë˜ì–´ì•¼ í•¨)",req:{key:"has_contract",v:!0},effects:[{type:"log",msg:"í¸ì§€ì—ëŠ” ë¶ìª½ íê´‘ì— ëŒ€í•œ ì§€ë„ê°€ ìˆì—ˆë‹¤."}],goto:"road"},{text:"ë– ë‚œë‹¤",goto:"road"}]},road:{text:"ë¨¼ ê¸¸ì´ í¼ì³ì§„ë‹¤. ë„ˆëŠ” ë‹¤ìŒ ì—¬ì •ì„ ë– ë‚  ì¤€ë¹„ê°€ ë˜ì—ˆë‹¤.",choices:[{text:"ì²˜ìŒìœ¼ë¡œ",goto:"intro"}]}},h={start:p,nodes:y};function k(){const s=u.useMemo(()=>{const r=m({nodes:h.nodes,start:h.start}),a=v("seed-demo",[r]);return a.dispatch("narrative","start"),a},[]),[,c]=u.useState(0);return[s,()=>c(r=>r+1)]}function b(){var t,d,g;const[s,c]=k(),n=(d=(t=s.ctx.state)==null?void 0:t.narrative)==null?void 0:d.nodeId,r=h.nodes[n],a=s.ctx.state.resources||{},i=s.ctx.state.flags||{};function f(o){s.dispatch("narrative","choose",{index:o}),c()}return e.jsxs("div",{className:"wrap",children:[e.jsxs("div",{className:"row",style:{marginBottom:12},children:[e.jsxs("div",{className:"kpi",children:["ğŸ’° gold: ",e.jsx("b",{children:a.gold||0})]}),e.jsxs("div",{className:"kpi",children:["ğŸ“ node: ",e.jsx("b",{children:n})]}),e.jsx("button",{className:"btn",onClick:()=>{s.dispatch("narrative","start"),c()},children:"Restart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"title",children:n.toUpperCase()}),e.jsx("div",{style:{marginBottom:12},children:r.text}),e.jsx("div",{className:"row",style:{flexDirection:"column",alignItems:"stretch",gap:8},children:(g=r.choices)==null?void 0:g.map((o,l)=>{const x=o.req?(s.ctx.state.flags[o.req.key]||!1)!==(o.req.v??!0):!1;return e.jsxs("button",{className:"choice",onClick:()=>f(l),disabled:x,children:[o.text," ",x?" (ìš”ê±´ ë¯¸ì¶©ì¡±)":""]},l)})}),e.jsx("div",{className:"log",children:s.ctx.log.slice(-10).map((o,l)=>e.jsxs("div",{children:["â€¢ ",o.msg]},l))}),e.jsxs("div",{style:{opacity:.6,marginTop:6,fontSize:12},children:["flags: ",Object.keys(i).length?JSON.stringify(i):"ì—†ìŒ"]})]})]})}export{b as default};
