import{j as e,r as u}from"./index-Dwc8S6Nr.js";import{c as v}from"./index-oiFZrnAu.js";function m(s={}){const c=s.nodes||{},n=s.start||Object.keys(c)[0];let r={nodeId:n};return{id:"narrative",init(a){a.state.narrative||(a.state.narrative={}),Object.assign(a.state.narrative,r)},actions:{start(a,i){return r.nodeId=n,i.state.narrative.nodeId=n,[{type:"log",msg:"모험을 시작한다."}]},choose({index:a},i){var g;const f=c[r.nodeId],t=(g=f==null?void 0:f.choices)==null?void 0:g[a];if(!t)return[];if(t.req){const o=t.req.v!==void 0?t.req.v:!0;if((i.state.flags[t.req.key]||!1)!==o)return[{type:"log",msg:"그 선택은 지금은 할 수 없다."}]}const d=[];if(Array.isArray(t.effects)&&d.push(...t.effects),t.set)for(const[o,l]of Object.entries(t.set))d.push({type:"flag.set",key:o,v:l});return t.goto&&(r.nodeId=t.goto,i.state.narrative.nodeId=t.goto),t.text&&d.push({type:"log",msg:`▶ ${t.text}`}),d}}}}const p="intro",y={intro:{text:"해가 저무는 숲 입구. 너는 주머니에 동전 몇 닢과 녹슨 단검 하나를 쥐고 있다.",choices:[{text:"주점으로 간다",goto:"tavern",effects:[{type:"resource.add",k:"gold",v:5},{type:"log",msg:"주인은 첫 잔을 공짜로 내어준다."}]},{text:"숲으로 들어간다",goto:"forest",effects:[{type:"log",msg:"바람이 잎사귀를 스친다."}]}]},tavern:{text:"시끌벅적한 주점. 수상한 계약서를 흔드는 상인이 보인다.",choices:[{text:"계약서를 읽는다 (용병 모집)",effects:[{type:"flag.set",key:"has_contract",v:!0}],goto:"tavern"},{text:"상인에게서 정보를 산다 (-3 gold)",effects:[{type:"resource.add",k:"gold",v:-3},{type:"flag.set",key:"forest_hint",v:!0}],goto:"tavern"},{text:"숲으로 간다",goto:"forest"},{text:"마을 밖으로 떠난다",goto:"road"}]},forest:{text:"숲속 공터. 발자국이 겹겹이 찍혀 있다.",choices:[{text:"흔적을 따라간다 (힌트 필요)",req:{key:"forest_hint",v:!0},effects:[{type:"log",msg:"숨겨진 오두막을 찾았다."}],goto:"hut"},{text:"나무열매를 모은다 (+2 gold)",effects:[{type:"resource.add",k:"gold",v:2}],goto:"forest"},{text:"마을로 돌아간다",goto:"tavern"}]},hut:{text:"오두막 안에는 낡은 상자 하나와 봉인된 편지가 있다.",choices:[{text:"상자를 연다 (+10 gold)",effects:[{type:"resource.add",k:"gold",v:10}],goto:"hut"},{text:"편지를 연다 (계약이 활성화되어야 함)",req:{key:"has_contract",v:!0},effects:[{type:"log",msg:"편지에는 북쪽 폐광에 대한 지도가 있었다."}],goto:"road"},{text:"떠난다",goto:"road"}]},road:{text:"먼 길이 펼쳐진다. 너는 다음 여정을 떠날 준비가 되었다.",choices:[{text:"처음으로",goto:"intro"}]}},h={start:p,nodes:y};function k(){const s=u.useMemo(()=>{const r=m({nodes:h.nodes,start:h.start}),a=v("seed-demo",[r]);return a.dispatch("narrative","start"),a},[]),[,c]=u.useState(0);return[s,()=>c(r=>r+1)]}function b(){var t,d,g;const[s,c]=k(),n=(d=(t=s.ctx.state)==null?void 0:t.narrative)==null?void 0:d.nodeId,r=h.nodes[n],a=s.ctx.state.resources||{},i=s.ctx.state.flags||{};function f(o){s.dispatch("narrative","choose",{index:o}),c()}return e.jsxs("div",{className:"wrap",children:[e.jsxs("div",{className:"row",style:{marginBottom:12},children:[e.jsxs("div",{className:"kpi",children:["💰 gold: ",e.jsx("b",{children:a.gold||0})]}),e.jsxs("div",{className:"kpi",children:["📍 node: ",e.jsx("b",{children:n})]}),e.jsx("button",{className:"btn",onClick:()=>{s.dispatch("narrative","start"),c()},children:"Restart"})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"title",children:n.toUpperCase()}),e.jsx("div",{style:{marginBottom:12},children:r.text}),e.jsx("div",{className:"row",style:{flexDirection:"column",alignItems:"stretch",gap:8},children:(g=r.choices)==null?void 0:g.map((o,l)=>{const x=o.req?(s.ctx.state.flags[o.req.key]||!1)!==(o.req.v??!0):!1;return e.jsxs("button",{className:"choice",onClick:()=>f(l),disabled:x,children:[o.text," ",x?" (요건 미충족)":""]},l)})}),e.jsx("div",{className:"log",children:s.ctx.log.slice(-10).map((o,l)=>e.jsxs("div",{children:["• ",o.msg]},l))}),e.jsxs("div",{style:{opacity:.6,marginTop:6,fontSize:12},children:["flags: ",Object.keys(i).length?JSON.stringify(i):"없음"]})]})]})}export{b as default};
